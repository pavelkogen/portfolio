# Logrotate

Данная Ansile-роль используется для сервера логирования `syslog.COMPANYNAME.ru`.

В ней полностью описываются правила работы для rsyslog (система обработки логов) и logrotate (системная утилита, которая управляет автоматической ротацией и сжатием лог-файлов).

Главный конфиг по обработке логов для rsyslog располагается в `/files/etc/rsyslog.conf`, а для logrotate `/files/etc/lortotate.conf`.

logrotate использует так же конфиги из директории `/files/etc/logrotate.d`, в которых содержатся основные правила по ротации всех сохраняющихся логов.

## logrotate. Примечание по использованию параметра postrotate

Поскольку на данный момент сервер `syslog.COMPANYNAME.ru` работает на двух физических дисках, logrotate не может переносить данные с одного диска, и хранить их на другом. Скрипт `/files/adm/logrotate/postrotate.py` решает эту проблему.

Скрипт принимает в качестве аргумента два параметра: название директории откуда-куда будет переносить архивы .gz, и количество дней за которые следует сохранять архивы в директории `/var/log/rotator/` на сервере.

Так же он необходим для того, чтобы сохранять структуру директорий. Например, чтобы все файлы в директории `/syslog/fe.collect.logs` после ротации попадали именно в директорию `/var/log/rotator/fe.collect.logs`.

При добавлении нового параметра для ротации логов следует добавлять в postrotate линк на скрипт вида:
```
postrotate
    /usr/bin/python /adm/logrotate/postrotate.py *.collect.logs 50
endscript
```
Где указываем адрес интерпретатора Python, адрес скрипта, название директории (если директорий несколько, ставим * в месте где они не повторяются), количество дней необходимое для хранения логов.
