## Инструкция по работе со скриптом для генерации и запроса сертификатов в Vault

### Описание

Скрипт `generate_cert.sh` автоматически генерирует приватный ключ и CSR (Certificate Signing Request) для указанного домена, отправляет CSR в HashiCorp Vault для подписи, сохраняет полученный сертификат в файл и отправляет приватный ключ в Vault для безопасного хранения.

### Использование

#### 1. Убедитесь, что установлены необходимые зависимости:

- `openssl`
- `jq`
- `curl`

#### 2. Сделайте файл исполняемым:

```bash
chmod +x generate_cert.sh
```

3. Запустите скрипт, передав необходимые аргументы:

./generate_cert.sh <DOMAIN> <VAULT_TOKEN> <VAULT_ADDR> <ROLE_NAME> <KV_PATH>

Аргументы
    •   <DOMAIN>: Доменное имя для сертификата.
    •   <VAULT_TOKEN>: Токен для доступа к Vault.
    •   <VAULT_ADDR>: Адрес сервера Vault.
    •   <ROLE_NAME>: Имя роли в Vault.
    •   <KV_PATH>: Путь к KV хранилищу для сохранения приватного ключа.

Пример использования

```bash
./generate_cert.sh example.com hvs.yourtoken https://vault.example.com pki_role kv
```

Этот пример запустит скрипт для домена example.com, используя указанный Vault токен, адрес сервера Vault, имя роли pki_role и путь к KV хранилищу kv.

Проверка результатов:
1.  Убедитесь, что сертификат сохранен в локальном файле, указанном в переменной CERT_FILE.
2.  Убедитесь, что имеются соответствующие права доступа в Vault для использования указанной роли.
3.  Проверьте интерфейс Vault, чтобы убедиться, что приватный ключ успешно сохранен в хранилище по пути ${KV_PATH}/${DOMAIN}/key.
4.  Сертификаты и приватные ключи будут сохранены в файлы с именами `<DOMAIN>.crt` и `<DOMAIN>.key` соответственно в текущем рабочем каталоге.


## Инструкция по скачиванию сертификата и ключа

### Описание

После того, как сертификат и приватный ключ были выпущены и сохранены в Vault, можно загрузить их для использования.

### Использование

#### 1. Скачивание сертификата

Сертификат сохраняется в локальный файл в процессе выполнения скрипта `generate_cert.sh`. Для загрузки сертификата необходимо скачать файл с расширением `.crt` из текущего рабочего каталога.

#### 2. Скачивание приватного ключа

Приватный ключ сохраняется в Vault по указанному пути в хранилище KV. Для скачивания приватного ключа из Vault выполните следующие шаги:

1. Перейдите в интерфейс Vault по указанному адресу.
2. Перейдите в раздел "Secrets" и выберите KV хранилище.
3. Найдите путь, соответствующий вашему домену, например `${KV_PATH}/${DOMAIN}/key`.
4. Скачайте приватный ключ из интерфейса Vault.

### Пример использования

1. **Скачивание сертификата**:
   - Перейдите в текущий рабочий каталог и найдите файл `<DOMAIN>.crt`.
   - Скопируйте или переместите файл в нужное место для использования.

2. **Скачивание приватного ключа из Vault**:
   - Откройте интерфейс Vault.
   - Перейдите по пути `Secrets -> kv -> <DOMAIN> -> key`.
   - Скачайте приватный ключ, используя интерфейс Vault.